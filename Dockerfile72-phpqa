FROM php:7.2-stretch

ADD ./scripts /scripts
ADD ./bin/slack /usr/local/bin
RUN /scripts/php_install.sh
RUN /scripts/node_install.sh
RUN apt-get install jq libxml2-utils -yqq
RUN apt-get clean
RUN npm install -g diff2html-cli
ADD ./phpqa /phpqa
WORKDIR /phpqa
RUN composer install
RUN ln -sr ./scripts/phpunit-coverage vendor/bin/phpunit-coverage
RUN ln -sr ./scripts/phpunit-result vendor/bin/phpunit-result
RUN patch vendor/consolidation/robo/src/Task/Base/ParallelExec.php < error_output.patch
CMD /phpqa/vendor/bin/phpqa
